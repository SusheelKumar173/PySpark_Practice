{
  "cells": [
    {
      "cell_type": "markdown",
      "metadata": {
        "id": "view-in-github",
        "colab_type": "text"
      },
      "source": [
        "<a href=\"https://colab.research.google.com/github/SusheelKumar173/PySpark_Practice/blob/main/Day3\" target=\"_parent\"><img src=\"https://colab.research.google.com/assets/colab-badge.svg\" alt=\"Open In Colab\"/></a>"
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "!pip install pyspark"
      ],
      "metadata": {
        "id": "1FdYzuimF6eP",
        "outputId": "65fa83b7-68d8-4f2d-d6b2-0019893b41b9",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 1,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "Looking in indexes: https://pypi.org/simple, https://us-python.pkg.dev/colab-wheels/public/simple/\n",
            "Collecting pyspark\n",
            "  Downloading pyspark-3.4.0.tar.gz (310.8 MB)\n",
            "\u001b[2K     \u001b[90m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━\u001b[0m \u001b[32m310.8/310.8 MB\u001b[0m \u001b[31m3.9 MB/s\u001b[0m eta \u001b[36m0:00:00\u001b[0m\n",
            "\u001b[?25h  Preparing metadata (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
            "Requirement already satisfied: py4j==0.10.9.7 in /usr/local/lib/python3.9/dist-packages (from pyspark) (0.10.9.7)\n",
            "Building wheels for collected packages: pyspark\n",
            "  Building wheel for pyspark (setup.py) ... \u001b[?25l\u001b[?25hdone\n",
            "  Created wheel for pyspark: filename=pyspark-3.4.0-py2.py3-none-any.whl size=311317145 sha256=e0c116b9c7e3b967373fea3adcb7dbbadcb50f5f062a38909685e771fd0d90bc\n",
            "  Stored in directory: /root/.cache/pip/wheels/9f/34/a4/159aa12d0a510d5ff7c8f0220abbea42e5d81ecf588c4fd884\n",
            "Successfully built pyspark\n",
            "Installing collected packages: pyspark\n",
            "Successfully installed pyspark-3.4.0\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "from pyspark.sql import SparkSession\n",
        "from pyspark.sql.types import StructType,StructField,IntegerType,StringType,DateType\n",
        "from pyspark.sql.functions import when,lit,col,concat\n",
        "import pyspark.sql.functions as func"
      ],
      "metadata": {
        "id": "vYModmXGF-0l"
      },
      "execution_count": 2,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "my_spark = SparkSession.builder.appName('Practice').getOrCreate()"
      ],
      "metadata": {
        "id": "PGX8qh0RGCCK"
      },
      "execution_count": 3,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "my_spark"
      ],
      "metadata": {
        "id": "5JMVIazpGOro",
        "outputId": "622c4e0e-a433-453e-eed0-940e73acf2f0",
        "colab": {
          "base_uri": "https://localhost:8080/",
          "height": 219
        }
      },
      "execution_count": 4,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "<pyspark.sql.session.SparkSession at 0x7fb7a7790310>"
            ],
            "text/html": [
              "\n",
              "            <div>\n",
              "                <p><b>SparkSession - in-memory</b></p>\n",
              "                \n",
              "        <div>\n",
              "            <p><b>SparkContext</b></p>\n",
              "\n",
              "            <p><a href=\"http://c908c0bf54ba:4040\">Spark UI</a></p>\n",
              "\n",
              "            <dl>\n",
              "              <dt>Version</dt>\n",
              "                <dd><code>v3.4.0</code></dd>\n",
              "              <dt>Master</dt>\n",
              "                <dd><code>local[*]</code></dd>\n",
              "              <dt>AppName</dt>\n",
              "                <dd><code>Practice</code></dd>\n",
              "            </dl>\n",
              "        </div>\n",
              "        \n",
              "            </div>\n",
              "        "
            ]
          },
          "metadata": {},
          "execution_count": 4
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "# stud_df = my_spark.read.csv('Student.csv',header=True,inferSchema=True)\n",
        "stud_df = my_spark.read.csv('Student.csv',header=True)"
      ],
      "metadata": {
        "id": "pgdLNYh2GVDO"
      },
      "execution_count": 112,
      "outputs": []
    },
    {
      "cell_type": "markdown",
      "source": [],
      "metadata": {
        "id": "VG3aeY2UCBvj"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "hEyMzWRiGd5S",
        "outputId": "7275095b-e8d2-45e1-d050-4e80b5b87b4b",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 113,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|19/05/2022|   1|     cloud|\n",
            "|  2|        G|  Sravani|   95|     80|       88|19/05/2022|   2|      biba|\n",
            "|  3|        N|   Alekya|   88|     80|       85|23/04/2022|   2|      biba|\n",
            "|  4|        A|  Sravani|   97|     80|       98|19/05/2022|   1|     cloud|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|23/04/2022|   1|     cloud|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|23/04/2022|   1|     cloud|\n",
            "|  7|        K|     Aman|   87|     88|       81|23/04/2022|   3|       atm|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|23/04/2022|   4|        ES|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|11/11/2022|   4|        ES|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|11/11/2022|   4|        ES|\n",
            "| 11|       Om|     Raut|   91|     89|       89|11/11/2022|   4|        ES|\n",
            "| 12|        S|      Ram|   70|     80|       85|11/11/2022|   4|        ES|\n",
            "| 13|        R|    Ramya|   85|     70|       80|11/11/2022|   4|        ES|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|11/11/2022|   4|        ES|\n",
            "| 15|        M|  Deepika|   70|     75|       78|11/11/2022|   4|        ES|\n",
            "| 16|        S|    Rohit| null|   null|     null|23/04/2022|null|       atm|\n",
            "| 17|        C|   Shreya| null|   null|     null|23/04/2022|null|      biba|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.printSchema()"
      ],
      "metadata": {
        "id": "ltTUG_cZ3o0C",
        "outputId": "28dd054b-abda-4384-bcb2-d0d1e82102c5",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 114,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "root\n",
            " |-- sid: string (nullable = true)\n",
            " |-- firstname: string (nullable = true)\n",
            " |-- lastname: string (nullable = true)\n",
            " |-- maths: string (nullable = true)\n",
            " |-- physics: string (nullable = true)\n",
            " |-- chemistry: string (nullable = true)\n",
            " |-- doj: string (nullable = true)\n",
            " |-- tid: string (nullable = true)\n",
            " |-- competency: string (nullable = true)\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = my_spark.read.format(\"csv\").option(\"header\",True).option(\"inferSchema\",True).load(\"Student.csv\")"
      ],
      "metadata": {
        "id": "0DF40-ckGgps"
      },
      "execution_count": 115,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "ZDe4f-nIJE4G",
        "outputId": "d85006bb-fc2d-4752-c78b-cd23dbebf09a",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 116,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|19/05/2022|   1|     cloud|\n",
            "|  2|        G|  Sravani|   95|     80|       88|19/05/2022|   2|      biba|\n",
            "|  3|        N|   Alekya|   88|     80|       85|23/04/2022|   2|      biba|\n",
            "|  4|        A|  Sravani|   97|     80|       98|19/05/2022|   1|     cloud|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|23/04/2022|   1|     cloud|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|23/04/2022|   1|     cloud|\n",
            "|  7|        K|     Aman|   87|     88|       81|23/04/2022|   3|       atm|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|23/04/2022|   4|        ES|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|11/11/2022|   4|        ES|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|11/11/2022|   4|        ES|\n",
            "| 11|       Om|     Raut|   91|     89|       89|11/11/2022|   4|        ES|\n",
            "| 12|        S|      Ram|   70|     80|       85|11/11/2022|   4|        ES|\n",
            "| 13|        R|    Ramya|   85|     70|       80|11/11/2022|   4|        ES|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|11/11/2022|   4|        ES|\n",
            "| 15|        M|  Deepika|   70|     75|       78|11/11/2022|   4|        ES|\n",
            "| 16|        S|    Rohit| null|   null|     null|23/04/2022|null|       atm|\n",
            "| 17|        C|   Shreya| null|   null|     null|23/04/2022|null|      biba|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.printSchema()"
      ],
      "metadata": {
        "id": "xMhuVs4YJJK7",
        "outputId": "b50ef0f1-1977-4a88-eb1c-3b76f4be4ef7",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 117,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "root\n",
            " |-- sid: integer (nullable = true)\n",
            " |-- firstname: string (nullable = true)\n",
            " |-- lastname: string (nullable = true)\n",
            " |-- maths: integer (nullable = true)\n",
            " |-- physics: integer (nullable = true)\n",
            " |-- chemistry: integer (nullable = true)\n",
            " |-- doj: string (nullable = true)\n",
            " |-- tid: integer (nullable = true)\n",
            " |-- competency: string (nullable = true)\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "markdown",
      "source": [],
      "metadata": {
        "id": "mfdA67KILewg"
      }
    },
    {
      "cell_type": "code",
      "source": [
        "my_schema = StructType([\n",
        "    StructField(\"sid\",IntegerType(),nullable=False),\n",
        "    StructField(\"firstname\",StringType(),True),\n",
        "    StructField(\"lastname\",StringType(),True),\n",
        "    StructField(\"maths\",IntegerType(),True),\n",
        "    StructField(\"physics\",IntegerType(),True),\n",
        "    StructField(\"chemistry\",IntegerType(),True),\n",
        "    StructField(\"doj\",DateType(),True),\n",
        "    StructField(\"tid\",IntegerType(),True),\n",
        "    StructField(\"competency\",StringType(),True)\n",
        "])"
      ],
      "metadata": {
        "id": "1Dt01SvYJL63"
      },
      "execution_count": 118,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = my_spark.read.format(\"csv\").option(\"header\",True).schema(my_schema).option(\"dateFormat\",\"d/M/y\").load(\"Student.csv\")\n",
        "# stud_df = my_spark.read.csv(\"Student.csv\",header=True,schema=my_schema,dateFormat=\"d/M/y\")\n"
      ],
      "metadata": {
        "id": "8NG_K1MXKOTR"
      },
      "execution_count": 119,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.printSchema()"
      ],
      "metadata": {
        "id": "oQ_zgSN2KW2W",
        "outputId": "ecf2ba18-28b6-4bda-c279-f868b7cf18f2",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 120,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "root\n",
            " |-- sid: integer (nullable = true)\n",
            " |-- firstname: string (nullable = true)\n",
            " |-- lastname: string (nullable = true)\n",
            " |-- maths: integer (nullable = true)\n",
            " |-- physics: integer (nullable = true)\n",
            " |-- chemistry: integer (nullable = true)\n",
            " |-- doj: date (nullable = true)\n",
            " |-- tid: integer (nullable = true)\n",
            " |-- competency: string (nullable = true)\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "2zTXdNt3KZZM",
        "outputId": "123e7749-e429-4aee-a0a1-835dbc9bc261",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 121,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|2022-05-19|   1|     cloud|\n",
            "|  2|        G|  Sravani|   95|     80|       88|2022-05-19|   2|      biba|\n",
            "|  3|        N|   Alekya|   88|     80|       85|2022-04-23|   2|      biba|\n",
            "|  4|        A|  Sravani|   97|     80|       98|2022-05-19|   1|     cloud|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|2022-04-23|   1|     cloud|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|2022-04-23|   1|     cloud|\n",
            "|  7|        K|     Aman|   87|     88|       81|2022-04-23|   3|       atm|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|2022-04-23|   4|        ES|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|2022-11-11|   4|        ES|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|2022-11-11|   4|        ES|\n",
            "| 11|       Om|     Raut|   91|     89|       89|2022-11-11|   4|        ES|\n",
            "| 12|        S|      Ram|   70|     80|       85|2022-11-11|   4|        ES|\n",
            "| 13|        R|    Ramya|   85|     70|       80|2022-11-11|   4|        ES|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|2022-11-11|   4|        ES|\n",
            "| 15|        M|  Deepika|   70|     75|       78|2022-11-11|   4|        ES|\n",
            "| 16|        S|    Rohit| null|   null|     null|2022-04-23|null|       atm|\n",
            "| 17|        C|   Shreya| null|   null|     null|2022-04-23|null|      biba|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = stud_df.withColumn(\"School\",lit(\"ABC\"))"
      ],
      "metadata": {
        "id": "jFEOf5sfMga4"
      },
      "execution_count": 122,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "ILBHUtDtMy2I",
        "outputId": "2ce97535-0e30-4440-f03e-8d440cba59c3",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 123,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|School|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|2022-05-19|   1|     cloud|   ABC|\n",
            "|  2|        G|  Sravani|   95|     80|       88|2022-05-19|   2|      biba|   ABC|\n",
            "|  3|        N|   Alekya|   88|     80|       85|2022-04-23|   2|      biba|   ABC|\n",
            "|  4|        A|  Sravani|   97|     80|       98|2022-05-19|   1|     cloud|   ABC|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|2022-04-23|   1|     cloud|   ABC|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|2022-04-23|   1|     cloud|   ABC|\n",
            "|  7|        K|     Aman|   87|     88|       81|2022-04-23|   3|       atm|   ABC|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|2022-04-23|   4|        ES|   ABC|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|2022-11-11|   4|        ES|   ABC|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|2022-11-11|   4|        ES|   ABC|\n",
            "| 11|       Om|     Raut|   91|     89|       89|2022-11-11|   4|        ES|   ABC|\n",
            "| 12|        S|      Ram|   70|     80|       85|2022-11-11|   4|        ES|   ABC|\n",
            "| 13|        R|    Ramya|   85|     70|       80|2022-11-11|   4|        ES|   ABC|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|2022-11-11|   4|        ES|   ABC|\n",
            "| 15|        M|  Deepika|   70|     75|       78|2022-11-11|   4|        ES|   ABC|\n",
            "| 16|        S|    Rohit| null|   null|     null|2022-04-23|null|       atm|   ABC|\n",
            "| 17|        C|   Shreya| null|   null|     null|2022-04-23|null|      biba|   ABC|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = stud_df.withColumn(\"Total Marks\",(stud_df.maths + stud_df.physics + stud_df.chemistry))"
      ],
      "metadata": {
        "id": "Hi2eAOyXKpdE"
      },
      "execution_count": 124,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "UUozS70cMW8X",
        "outputId": "84c58722-81e4-47fa-fb11-cb23c3febeef",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 125,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|School|Total Marks|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|2022-05-19|   1|     cloud|   ABC|        293|\n",
            "|  2|        G|  Sravani|   95|     80|       88|2022-05-19|   2|      biba|   ABC|        263|\n",
            "|  3|        N|   Alekya|   88|     80|       85|2022-04-23|   2|      biba|   ABC|        253|\n",
            "|  4|        A|  Sravani|   97|     80|       98|2022-05-19|   1|     cloud|   ABC|        275|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|2022-04-23|   1|     cloud|   ABC|        275|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|2022-04-23|   1|     cloud|   ABC|        244|\n",
            "|  7|        K|     Aman|   87|     88|       81|2022-04-23|   3|       atm|   ABC|        256|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|2022-04-23|   4|        ES|   ABC|        235|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|2022-11-11|   4|        ES|   ABC|        244|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|2022-11-11|   4|        ES|   ABC|        134|\n",
            "| 11|       Om|     Raut|   91|     89|       89|2022-11-11|   4|        ES|   ABC|        269|\n",
            "| 12|        S|      Ram|   70|     80|       85|2022-11-11|   4|        ES|   ABC|        235|\n",
            "| 13|        R|    Ramya|   85|     70|       80|2022-11-11|   4|        ES|   ABC|        235|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|2022-11-11|   4|        ES|   ABC|        235|\n",
            "| 15|        M|  Deepika|   70|     75|       78|2022-11-11|   4|        ES|   ABC|        223|\n",
            "| 16|        S|    Rohit| null|   null|     null|2022-04-23|null|       atm|   ABC|       null|\n",
            "| 17|        C|   Shreya| null|   null|     null|2022-04-23|null|      biba|   ABC|       null|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = stud_df.withColumn(\"Percentage\",(((stud_df['Total Marks'])/300)*100))"
      ],
      "metadata": {
        "id": "UWnBsH3uMaj3"
      },
      "execution_count": 126,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "Q0H4jIMrNNTd",
        "outputId": "8172cfca-22b2-4147-92ae-945d2cfe812c",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 127,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+------------------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|School|Total Marks|        Percentage|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+------------------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|2022-05-19|   1|     cloud|   ABC|        293| 97.66666666666667|\n",
            "|  2|        G|  Sravani|   95|     80|       88|2022-05-19|   2|      biba|   ABC|        263| 87.66666666666667|\n",
            "|  3|        N|   Alekya|   88|     80|       85|2022-04-23|   2|      biba|   ABC|        253| 84.33333333333334|\n",
            "|  4|        A|  Sravani|   97|     80|       98|2022-05-19|   1|     cloud|   ABC|        275| 91.66666666666666|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|2022-04-23|   1|     cloud|   ABC|        275| 91.66666666666666|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|2022-04-23|   1|     cloud|   ABC|        244| 81.33333333333333|\n",
            "|  7|        K|     Aman|   87|     88|       81|2022-04-23|   3|       atm|   ABC|        256| 85.33333333333334|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|2022-04-23|   4|        ES|   ABC|        235| 78.33333333333333|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|2022-11-11|   4|        ES|   ABC|        244| 81.33333333333333|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|2022-11-11|   4|        ES|   ABC|        134|44.666666666666664|\n",
            "| 11|       Om|     Raut|   91|     89|       89|2022-11-11|   4|        ES|   ABC|        269| 89.66666666666666|\n",
            "| 12|        S|      Ram|   70|     80|       85|2022-11-11|   4|        ES|   ABC|        235| 78.33333333333333|\n",
            "| 13|        R|    Ramya|   85|     70|       80|2022-11-11|   4|        ES|   ABC|        235| 78.33333333333333|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|2022-11-11|   4|        ES|   ABC|        235| 78.33333333333333|\n",
            "| 15|        M|  Deepika|   70|     75|       78|2022-11-11|   4|        ES|   ABC|        223| 74.33333333333333|\n",
            "| 16|        S|    Rohit| null|   null|     null|2022-04-23|null|       atm|   ABC|       null|              null|\n",
            "| 17|        C|   Shreya| null|   null|     null|2022-04-23|null|      biba|   ABC|       null|              null|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+------------------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = stud_df.withColumn(\"Percentage\",func.round(stud_df['Percentage'],2))"
      ],
      "metadata": {
        "id": "PakfRnH8NSZE"
      },
      "execution_count": 128,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "gvn3IgYGOCRY",
        "outputId": "38a4d7bc-33b6-4a9c-fd39-77509b989a1c",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 129,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+----------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|School|Total Marks|Percentage|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+----------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|2022-05-19|   1|     cloud|   ABC|        293|     97.67|\n",
            "|  2|        G|  Sravani|   95|     80|       88|2022-05-19|   2|      biba|   ABC|        263|     87.67|\n",
            "|  3|        N|   Alekya|   88|     80|       85|2022-04-23|   2|      biba|   ABC|        253|     84.33|\n",
            "|  4|        A|  Sravani|   97|     80|       98|2022-05-19|   1|     cloud|   ABC|        275|     91.67|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|2022-04-23|   1|     cloud|   ABC|        275|     91.67|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|2022-04-23|   1|     cloud|   ABC|        244|     81.33|\n",
            "|  7|        K|     Aman|   87|     88|       81|2022-04-23|   3|       atm|   ABC|        256|     85.33|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|2022-04-23|   4|        ES|   ABC|        235|     78.33|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|2022-11-11|   4|        ES|   ABC|        244|     81.33|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|2022-11-11|   4|        ES|   ABC|        134|     44.67|\n",
            "| 11|       Om|     Raut|   91|     89|       89|2022-11-11|   4|        ES|   ABC|        269|     89.67|\n",
            "| 12|        S|      Ram|   70|     80|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|\n",
            "| 13|        R|    Ramya|   85|     70|       80|2022-11-11|   4|        ES|   ABC|        235|     78.33|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|\n",
            "| 15|        M|  Deepika|   70|     75|       78|2022-11-11|   4|        ES|   ABC|        223|     74.33|\n",
            "| 16|        S|    Rohit| null|   null|     null|2022-04-23|null|       atm|   ABC|       null|      null|\n",
            "| 17|        C|   Shreya| null|   null|     null|2022-04-23|null|      biba|   ABC|       null|      null|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.rdd.getNumPartitions()"
      ],
      "metadata": {
        "id": "6J1XIeoXODx4",
        "outputId": "fa659dff-2614-4a7d-d9e1-1bf15eee89fe",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 130,
      "outputs": [
        {
          "output_type": "execute_result",
          "data": {
            "text/plain": [
              "1"
            ]
          },
          "metadata": {},
          "execution_count": 130
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.groupBy('doj').count().show()"
      ],
      "metadata": {
        "id": "E3fSt9ChQWYZ",
        "outputId": "e3652fd7-01c6-4be1-8998-8659470cf158",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 131,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+----------+-----+\n",
            "|       doj|count|\n",
            "+----------+-----+\n",
            "|2022-05-19|    3|\n",
            "|2022-11-11|    7|\n",
            "|2022-04-23|    7|\n",
            "+----------+-----+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.groupBy('competency').max('Total Marks').alias(\"A\").show()\n"
      ],
      "metadata": {
        "id": "0QhvZ6PKQg5W",
        "outputId": "72a53897-71b9-412c-8301-2b9cf8d80862",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 132,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+----------+----------------+\n",
            "|competency|max(Total Marks)|\n",
            "+----------+----------------+\n",
            "|       atm|             256|\n",
            "|        ES|             269|\n",
            "|     cloud|             293|\n",
            "|      biba|             263|\n",
            "+----------+----------------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.groupBy('competency').max('Percentage').show()"
      ],
      "metadata": {
        "id": "SvUp1zYdQn3N",
        "outputId": "71dbb4f3-01e9-46a5-cc0b-b97b7523ffae",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 133,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+----------+---------------+\n",
            "|competency|max(Percentage)|\n",
            "+----------+---------------+\n",
            "|       atm|          85.33|\n",
            "|        ES|          89.67|\n",
            "|     cloud|          97.67|\n",
            "|      biba|          87.67|\n",
            "+----------+---------------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = stud_df.withColumn(\"name\",concat(\"firstname\",concat(lit(\" \"),\"lastname\")))"
      ],
      "metadata": {
        "id": "qvHDPwY_XrHN"
      },
      "execution_count": 134,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "nE88si3OX-sJ",
        "outputId": "5ac6a8cb-ac52-442d-e526-2a556c869ff6",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 135,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+----------+--------------+\n",
            "|sid|firstname| lastname|maths|physics|chemistry|       doj| tid|competency|School|Total Marks|Percentage|          name|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+----------+--------------+\n",
            "|  1|        G|  Susheel|   98|     97|       98|2022-05-19|   1|     cloud|   ABC|        293|     97.67|     G Susheel|\n",
            "|  2|        G|  Sravani|   95|     80|       88|2022-05-19|   2|      biba|   ABC|        263|     87.67|     G Sravani|\n",
            "|  3|        N|   Alekya|   88|     80|       85|2022-04-23|   2|      biba|   ABC|        253|     84.33|      N Alekya|\n",
            "|  4|        A|  Sravani|   97|     80|       98|2022-05-19|   1|     cloud|   ABC|        275|     91.67|     A Sravani|\n",
            "|  5|        C|  Bhavesh|   98|     80|       97|2022-04-23|   1|     cloud|   ABC|        275|     91.67|     C Bhavesh|\n",
            "|  6|        G|  Kalpana|   80|     83|       81|2022-04-23|   1|     cloud|   ABC|        244|     81.33|     G Kalpana|\n",
            "|  7|        K|     Aman|   87|     88|       81|2022-04-23|   3|       atm|   ABC|        256|     85.33|        K Aman|\n",
            "|  8|     Neel|Prashanth|   80|     78|       77|2022-04-23|   4|        ES|   ABC|        235|     78.33|Neel Prashanth|\n",
            "|  9|        S|Rajamouli|   89|     78|       77|2022-11-11|   4|        ES|   ABC|        244|     81.33|   S Rajamouli|\n",
            "| 10|       N |   Ashwin|   70|     32|       32|2022-11-11|   4|        ES|   ABC|        134|     44.67|     N  Ashwin|\n",
            "| 11|       Om|     Raut|   91|     89|       89|2022-11-11|   4|        ES|   ABC|        269|     89.67|       Om Raut|\n",
            "| 12|        S|      Ram|   70|     80|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|         S Ram|\n",
            "| 13|        R|    Ramya|   85|     70|       80|2022-11-11|   4|        ES|   ABC|        235|     78.33|       R Ramya|\n",
            "| 14|        V| Nagaraja|   80|     70|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|    V Nagaraja|\n",
            "| 15|        M|  Deepika|   70|     75|       78|2022-11-11|   4|        ES|   ABC|        223|     74.33|     M Deepika|\n",
            "| 16|        S|    Rohit| null|   null|     null|2022-04-23|null|       atm|   ABC|       null|      null|       S Rohit|\n",
            "| 17|        C|   Shreya| null|   null|     null|2022-04-23|null|      biba|   ABC|       null|      null|      C Shreya|\n",
            "+---+---------+---------+-----+-------+---------+----------+----+----------+------+-----------+----------+--------------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = stud_df.drop(\"firstname\",\"lastname\")"
      ],
      "metadata": {
        "id": "SSBnduvbBqbW"
      },
      "execution_count": 136,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "A2kdRiQ8YelU",
        "outputId": "bfa1fa55-d9d2-4980-9cb3-33b34cb83fe5",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 138,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+-----+-------+---------+----------+----+----------+------+-----------+----------+--------------+\n",
            "|sid|maths|physics|chemistry|       doj| tid|competency|School|Total Marks|Percentage|          name|\n",
            "+---+-----+-------+---------+----------+----+----------+------+-----------+----------+--------------+\n",
            "|  1|   98|     97|       98|2022-05-19|   1|     cloud|   ABC|        293|     97.67|     G Susheel|\n",
            "|  2|   95|     80|       88|2022-05-19|   2|      biba|   ABC|        263|     87.67|     G Sravani|\n",
            "|  3|   88|     80|       85|2022-04-23|   2|      biba|   ABC|        253|     84.33|      N Alekya|\n",
            "|  4|   97|     80|       98|2022-05-19|   1|     cloud|   ABC|        275|     91.67|     A Sravani|\n",
            "|  5|   98|     80|       97|2022-04-23|   1|     cloud|   ABC|        275|     91.67|     C Bhavesh|\n",
            "|  6|   80|     83|       81|2022-04-23|   1|     cloud|   ABC|        244|     81.33|     G Kalpana|\n",
            "|  7|   87|     88|       81|2022-04-23|   3|       atm|   ABC|        256|     85.33|        K Aman|\n",
            "|  8|   80|     78|       77|2022-04-23|   4|        ES|   ABC|        235|     78.33|Neel Prashanth|\n",
            "|  9|   89|     78|       77|2022-11-11|   4|        ES|   ABC|        244|     81.33|   S Rajamouli|\n",
            "| 10|   70|     32|       32|2022-11-11|   4|        ES|   ABC|        134|     44.67|     N  Ashwin|\n",
            "| 11|   91|     89|       89|2022-11-11|   4|        ES|   ABC|        269|     89.67|       Om Raut|\n",
            "| 12|   70|     80|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|         S Ram|\n",
            "| 13|   85|     70|       80|2022-11-11|   4|        ES|   ABC|        235|     78.33|       R Ramya|\n",
            "| 14|   80|     70|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|    V Nagaraja|\n",
            "| 15|   70|     75|       78|2022-11-11|   4|        ES|   ABC|        223|     74.33|     M Deepika|\n",
            "| 16| null|   null|     null|2022-04-23|null|       atm|   ABC|       null|      null|       S Rohit|\n",
            "| 17| null|   null|     null|2022-04-23|null|      biba|   ABC|       null|      null|      C Shreya|\n",
            "+---+-----+-------+---------+----------+----+----------+------+-----------+----------+--------------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df = stud_df.select(['sid','name','maths','physics','chemistry','doj','tid','competency','school','Total Marks','Percentage'])"
      ],
      "metadata": {
        "id": "N-wM-SnqYIhI"
      },
      "execution_count": 139,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.show()"
      ],
      "metadata": {
        "id": "iPaXW2hyYgFK",
        "outputId": "a4dbdc4c-65cc-4549-ac2d-d4a63ae5fe24",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 140,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+--------------+-----+-------+---------+----------+----+----------+------+-----------+----------+\n",
            "|sid|          name|maths|physics|chemistry|       doj| tid|competency|school|Total Marks|Percentage|\n",
            "+---+--------------+-----+-------+---------+----------+----+----------+------+-----------+----------+\n",
            "|  1|     G Susheel|   98|     97|       98|2022-05-19|   1|     cloud|   ABC|        293|     97.67|\n",
            "|  2|     G Sravani|   95|     80|       88|2022-05-19|   2|      biba|   ABC|        263|     87.67|\n",
            "|  3|      N Alekya|   88|     80|       85|2022-04-23|   2|      biba|   ABC|        253|     84.33|\n",
            "|  4|     A Sravani|   97|     80|       98|2022-05-19|   1|     cloud|   ABC|        275|     91.67|\n",
            "|  5|     C Bhavesh|   98|     80|       97|2022-04-23|   1|     cloud|   ABC|        275|     91.67|\n",
            "|  6|     G Kalpana|   80|     83|       81|2022-04-23|   1|     cloud|   ABC|        244|     81.33|\n",
            "|  7|        K Aman|   87|     88|       81|2022-04-23|   3|       atm|   ABC|        256|     85.33|\n",
            "|  8|Neel Prashanth|   80|     78|       77|2022-04-23|   4|        ES|   ABC|        235|     78.33|\n",
            "|  9|   S Rajamouli|   89|     78|       77|2022-11-11|   4|        ES|   ABC|        244|     81.33|\n",
            "| 10|     N  Ashwin|   70|     32|       32|2022-11-11|   4|        ES|   ABC|        134|     44.67|\n",
            "| 11|       Om Raut|   91|     89|       89|2022-11-11|   4|        ES|   ABC|        269|     89.67|\n",
            "| 12|         S Ram|   70|     80|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|\n",
            "| 13|       R Ramya|   85|     70|       80|2022-11-11|   4|        ES|   ABC|        235|     78.33|\n",
            "| 14|    V Nagaraja|   80|     70|       85|2022-11-11|   4|        ES|   ABC|        235|     78.33|\n",
            "| 15|     M Deepika|   70|     75|       78|2022-11-11|   4|        ES|   ABC|        223|     74.33|\n",
            "| 16|       S Rohit| null|   null|     null|2022-04-23|null|       atm|   ABC|       null|      null|\n",
            "| 17|      C Shreya| null|   null|     null|2022-04-23|null|      biba|   ABC|       null|      null|\n",
            "+---+--------------+-----+-------+---------+----------+----+----------+------+-----------+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "from pyspark.sql.window import Window\n",
        "from pyspark.sql.functions import row_number,rank,dense_rank"
      ],
      "metadata": {
        "id": "zVfoXlvhQ8tk"
      },
      "execution_count": 141,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [],
      "metadata": {
        "id": "rShuCd3EYd2_"
      },
      "execution_count": 141,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "window = Window.partitionBy('competency').orderBy(stud_df['Total Marks'].desc())"
      ],
      "metadata": {
        "id": "MjQ_i_iEVf_W"
      },
      "execution_count": 142,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "ex_row_number = stud_df.withColumn(\"Row Number\",row_number().over(window)).select(['name','Competency','Total Marks','Row Number'])"
      ],
      "metadata": {
        "id": "B9RQypEVVuZP"
      },
      "execution_count": 143,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "ex_row_number.show()"
      ],
      "metadata": {
        "id": "iIShO4toV-qb",
        "outputId": "68be21f0-1a90-4672-c84f-ac277e7649de",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 144,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+--------------+----------+-----------+----------+\n",
            "|          name|Competency|Total Marks|Row Number|\n",
            "+--------------+----------+-----------+----------+\n",
            "|       Om Raut|        ES|        269|         1|\n",
            "|   S Rajamouli|        ES|        244|         2|\n",
            "|Neel Prashanth|        ES|        235|         3|\n",
            "|         S Ram|        ES|        235|         4|\n",
            "|       R Ramya|        ES|        235|         5|\n",
            "|    V Nagaraja|        ES|        235|         6|\n",
            "|     M Deepika|        ES|        223|         7|\n",
            "|     N  Ashwin|        ES|        134|         8|\n",
            "|        K Aman|       atm|        256|         1|\n",
            "|       S Rohit|       atm|       null|         2|\n",
            "|     G Sravani|      biba|        263|         1|\n",
            "|      N Alekya|      biba|        253|         2|\n",
            "|      C Shreya|      biba|       null|         3|\n",
            "|     G Susheel|     cloud|        293|         1|\n",
            "|     A Sravani|     cloud|        275|         2|\n",
            "|     C Bhavesh|     cloud|        275|         3|\n",
            "|     G Kalpana|     cloud|        244|         4|\n",
            "+--------------+----------+-----------+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "ex_row_number.withColumn('Rank',rank().over(window)).withColumn(\"Dense Rank\",dense_rank().over(window)).show()"
      ],
      "metadata": {
        "id": "gzEPi-_-Wg73",
        "outputId": "03c5efcf-e0c1-4a94-8613-68d356fa73bb",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 145,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+--------------+----------+-----------+----------+----+----------+\n",
            "|          name|Competency|Total Marks|Row Number|Rank|Dense Rank|\n",
            "+--------------+----------+-----------+----------+----+----------+\n",
            "|       Om Raut|        ES|        269|         1|   1|         1|\n",
            "|   S Rajamouli|        ES|        244|         2|   2|         2|\n",
            "|Neel Prashanth|        ES|        235|         3|   3|         3|\n",
            "|         S Ram|        ES|        235|         4|   3|         3|\n",
            "|       R Ramya|        ES|        235|         5|   3|         3|\n",
            "|    V Nagaraja|        ES|        235|         6|   3|         3|\n",
            "|     M Deepika|        ES|        223|         7|   7|         4|\n",
            "|     N  Ashwin|        ES|        134|         8|   8|         5|\n",
            "|        K Aman|       atm|        256|         1|   1|         1|\n",
            "|       S Rohit|       atm|       null|         2|   2|         2|\n",
            "|     G Sravani|      biba|        263|         1|   1|         1|\n",
            "|      N Alekya|      biba|        253|         2|   2|         2|\n",
            "|      C Shreya|      biba|       null|         3|   3|         3|\n",
            "|     G Susheel|     cloud|        293|         1|   1|         1|\n",
            "|     A Sravani|     cloud|        275|         2|   2|         2|\n",
            "|     C Bhavesh|     cloud|        275|         3|   2|         2|\n",
            "|     G Kalpana|     cloud|        244|         4|   4|         3|\n",
            "+--------------+----------+-----------+----------+----+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "teacher_df = my_spark.read.csv(\"Teacher.csv\",header=True,inferSchema=True)"
      ],
      "metadata": {
        "id": "sGTwKOesZF6d"
      },
      "execution_count": 146,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "teacher_df.show()"
      ],
      "metadata": {
        "id": "LfO7mykS5dZS",
        "outputId": "d061b3f5-eaa0-449a-88f8-a71dcbf69e46",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 147,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+---------+----------+\n",
            "|tid|    tname|competency|\n",
            "+---+---------+----------+\n",
            "|  1|  Prabhas|     cloud|\n",
            "|  2|   Salaar|      biba|\n",
            "|  3|Adipurush|       atm|\n",
            "|  4|      Ram|        ES|\n",
            "|  5| Lakshman|        hr|\n",
            "+---+---------+----------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "teacher_df.printSchema()"
      ],
      "metadata": {
        "id": "fspfNiMG5eqp",
        "outputId": "17defea6-6822-42fc-eaab-ec670b2224d2",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 148,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "root\n",
            " |-- tid: integer (nullable = true)\n",
            " |-- tname: string (nullable = true)\n",
            " |-- competency: string (nullable = true)\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.alias(\"A\").join(teacher_df.alias(\"B\"),col(\"A.tid\")==col(\"B.tid\"),\"inner\").select(col(\"A.sid\"),col(\"A.name\"),col(\"B.tname\").alias(\"Reporting Teacher\")).show()"
      ],
      "metadata": {
        "id": "qZaoOmib5jV_",
        "outputId": "69d012d9-632c-496d-b484-f103d9baeb83",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 149,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+--------------+-----------------+\n",
            "|sid|          name|Reporting Teacher|\n",
            "+---+--------------+-----------------+\n",
            "|  1|     G Susheel|          Prabhas|\n",
            "|  2|     G Sravani|           Salaar|\n",
            "|  3|      N Alekya|           Salaar|\n",
            "|  4|     A Sravani|          Prabhas|\n",
            "|  5|     C Bhavesh|          Prabhas|\n",
            "|  6|     G Kalpana|          Prabhas|\n",
            "|  7|        K Aman|        Adipurush|\n",
            "|  8|Neel Prashanth|              Ram|\n",
            "|  9|   S Rajamouli|              Ram|\n",
            "| 10|     N  Ashwin|              Ram|\n",
            "| 11|       Om Raut|              Ram|\n",
            "| 12|         S Ram|              Ram|\n",
            "| 13|       R Ramya|              Ram|\n",
            "| 14|    V Nagaraja|              Ram|\n",
            "| 15|     M Deepika|              Ram|\n",
            "+---+--------------+-----------------+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.alias(\"A\").join(teacher_df.alias(\"B\"),col(\"A.tid\")==col(\"B.tid\"),\"left\").select(col(\"A.sid\"),col(\"A.name\"),col(\"B.tname\").alias(\"Reporting Teacher\"),col(\"B.tid\")).show()"
      ],
      "metadata": {
        "id": "n4lcIohn9fO7",
        "outputId": "e42a168c-e718-4e84-8839-40ab6540fa7d",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 150,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+---+--------------+-----------------+----+\n",
            "|sid|          name|Reporting Teacher| tid|\n",
            "+---+--------------+-----------------+----+\n",
            "|  1|     G Susheel|          Prabhas|   1|\n",
            "|  2|     G Sravani|           Salaar|   2|\n",
            "|  3|      N Alekya|           Salaar|   2|\n",
            "|  4|     A Sravani|          Prabhas|   1|\n",
            "|  5|     C Bhavesh|          Prabhas|   1|\n",
            "|  6|     G Kalpana|          Prabhas|   1|\n",
            "|  7|        K Aman|        Adipurush|   3|\n",
            "|  8|Neel Prashanth|              Ram|   4|\n",
            "|  9|   S Rajamouli|              Ram|   4|\n",
            "| 10|     N  Ashwin|              Ram|   4|\n",
            "| 11|       Om Raut|              Ram|   4|\n",
            "| 12|         S Ram|              Ram|   4|\n",
            "| 13|       R Ramya|              Ram|   4|\n",
            "| 14|    V Nagaraja|              Ram|   4|\n",
            "| 15|     M Deepika|              Ram|   4|\n",
            "| 16|       S Rohit|             null|null|\n",
            "| 17|      C Shreya|             null|null|\n",
            "+---+--------------+-----------------+----+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [
        "stud_df.alias(\"A\").join(teacher_df.alias(\"B\"),col(\"A.tid\")==col(\"B.tid\"),\"right\").select(col(\"A.sid\"),col(\"A.name\"),col(\"B.tname\").alias(\"Reporting Teacher\"),col(\"B.tid\")).show()"
      ],
      "metadata": {
        "id": "WwPmoQth_AHT",
        "outputId": "116b2465-6330-4d15-f8af-89cb523d7c33",
        "colab": {
          "base_uri": "https://localhost:8080/"
        }
      },
      "execution_count": 151,
      "outputs": [
        {
          "output_type": "stream",
          "name": "stdout",
          "text": [
            "+----+--------------+-----------------+---+\n",
            "| sid|          name|Reporting Teacher|tid|\n",
            "+----+--------------+-----------------+---+\n",
            "|   6|     G Kalpana|          Prabhas|  1|\n",
            "|   5|     C Bhavesh|          Prabhas|  1|\n",
            "|   4|     A Sravani|          Prabhas|  1|\n",
            "|   1|     G Susheel|          Prabhas|  1|\n",
            "|   3|      N Alekya|           Salaar|  2|\n",
            "|   2|     G Sravani|           Salaar|  2|\n",
            "|   7|        K Aman|        Adipurush|  3|\n",
            "|  15|     M Deepika|              Ram|  4|\n",
            "|  14|    V Nagaraja|              Ram|  4|\n",
            "|  13|       R Ramya|              Ram|  4|\n",
            "|  12|         S Ram|              Ram|  4|\n",
            "|  11|       Om Raut|              Ram|  4|\n",
            "|  10|     N  Ashwin|              Ram|  4|\n",
            "|   9|   S Rajamouli|              Ram|  4|\n",
            "|   8|Neel Prashanth|              Ram|  4|\n",
            "|null|          null|         Lakshman|  5|\n",
            "+----+--------------+-----------------+---+\n",
            "\n"
          ]
        }
      ]
    },
    {
      "cell_type": "code",
      "source": [],
      "metadata": {
        "id": "V6LKWSuW_FqP"
      },
      "execution_count": 151,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [],
      "metadata": {
        "id": "74CfNp5GFS4e"
      },
      "execution_count": null,
      "outputs": []
    },
    {
      "cell_type": "code",
      "source": [
        "parquet_df = my_spark.read.format(\"parquet\").load(\"part*.parquet\")\n",
        " \n",
        "\n",
        "# append - creates a new file without touching the existing data at the location\n",
        "# overwrite - removes existing data files and adds new files\n",
        "# errorifExists - throws an error if we already have a files at the specified location (default)\n",
        "# ignore - writes the data if and only if the target directory is empty and ignores if some files already exists at the location\n",
        "\n",
        "\n",
        "parquet_write_df = parquet_df.write.format(\"parquet\").mode(\"overwrite\").option(\"path\",\"s3://susheel-glue-notebook-student-records-practice-1/target-data-store/Parquet/\").save() \n"
      ],
      "metadata": {
        "id": "BhiihbTlFS6u"
      },
      "execution_count": null,
      "outputs": []
    }
  ],
  "metadata": {
    "colab": {
      "name": "Welcome To Colaboratory",
      "provenance": [],
      "include_colab_link": true
    },
    "kernelspec": {
      "display_name": "Python 3",
      "name": "python3"
    }
  },
  "nbformat": 4,
  "nbformat_minor": 0
}